<!DOCTYPE html>
<html  lang="en">
    <head>
    <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" src="//normalize-css.googlecode.com/svn/trunk/normalize.css">
      <link rel="stylesheet" href="style.css">
    <title>Your Weather Report</title>
    <meta http-equiv="Content-Security-Policy" content="img-src https://pinion31.github.io">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>


    <script>
    $(document).ready(function() {
    //vars to hold position of user
    var currentLatitude;
    var currentLongitude;
    //gets lat and long coordinates
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(getCoordinates);
        } else {
            alert("4");
        }
    }
    //callback for getLocation()
    function getCoordinates(position) {
        currentLatitude = position.coords.latitude;
        currentLongitude = position.coords.longitude;
        callWeather();
        // now latitude and longitude are available
    }
    //converts temp from Kelvin to Fahrenheit
    function convertToFah(kelvin) {
        //° F = 9/5(° K - 273) + 32
        return ((9 / 5) * (kelvin - 273) + 32).toFixed(0);
    }
    //converts temp from Kelvin to Celsius
    function convertToCel(kelvin) {
        //T(°C) = T(K) - 273.15
        return (kelvin - 273.15).toFixed(0);
    }

    function updateBackground(condition) {
        //use rain background
        if (condition < 600) {
            $("body").css("background-image", "url('rain.jpg')");
        }
        //use snow background
        else if (condition >= 600 && condition < 701) {
            $("body").css({
                "background-image": "url('snow.jpg')",
                "background-position": "left bottom"
            });
        }
        // sunny background
        else {
            $("body").css("background-image", "url('sunny.jpg')");
        }
    }

    //now pass long and lat position to weather app
    function callWeather() {


        $.ajax({
            url: "https://api.openweathermap.org/data/2.5/weather?lat=" + currentLatitude + "&lon=" + currentLongitude + "&appid=d56826e484e74aa219e217dd00836b0d",
            dataType: "jsonp",
            success: function(result) {

                //update html with wx data
                $("#icon").attr("src", "https://openweathermap.org/img/w/" + result.weather[0].icon + ".png");

                $("#city").html("<h2>" + result.name + ", " + result["sys"].country + "</h2>");

                $("#temp").html("<h2>" + convertToFah(result["main"].temp) + "&#8457;/ " + convertToCel(result["main"].temp) + "&#8451;" + "</h2>");

                $("#condition").html("<h2>" + result.weather[0].main + "</h2>");

                $("#wind").html("<h2>" + result["wind"].speed + " mi/h" + "</h2>");

                updateBackground(result.weather[0].id);
            }
        });
    }
    // actually call the function getLocation
    getLocation();
  });

    </script>
    </head>
    <body>
        <div class="textBody">
            <h1>Your Weather For Today</h1>
        </div>
        <div class="tempText">
            <img id='icon' src=''>
            <h1 id="temp">79 F</h1>
        </div>
        <div class="wxContainer">
            <div class="wxReport" id="city">
                <h2>Austin,TX</h2>
            </div>
            <div class="wxReport" id="condition">
                <h2>Clear</h2>
            </div>
            <div class="wxReport" id="wind">
                <h2>N 10 mi/h</h2>
            </div>
        </div>
    </body>
</html>